## 🧩 一、环境准备

1. 打开你的 Conda 环境（例如 `aidoctor`）：

   ```bash
   conda activate aidoctor
   ```

2. 安装依赖：

   ```bash
   pip install datasets pandas openpyxl label-studio
   ```


   ```bash
   pip install datasets "transformers>=4.43" accelerate sentencepiece safetensors
   ```

## ⚙️ 二、生成标注任务文件

1. 把我给你的最新版 **`make_ls_tasks.py`** 保存到项目目录（和 `intent_classifier.py` 同级）。

2. 运行：

   ```bash
   python make_ls_tasks.py
   ```

3. 执行完成后，会自动生成三个文件：

   ```
   ls_tasks.json       ✅ 给 Label Studio 导入用（JSON 数组）
   ls_tasks.jsonl      （可选，脚本使用）
   ls_config.xml       ✅ Label Studio 标注配置文件
   ```

4. 输出类似：

   ```
   💾 Wrote tasks (array JSON): ls_tasks.json
   💾 Wrote tasks (JSONL): ls_tasks.jsonl
   ⚙️  Wrote LS config: ls_config.xml
   ✅ 完成：现在到 Label Studio -> 新建项目 -> 粘贴 ls_config.xml -> 导入 ls_tasks.json 即可开始标注。
   ```

------

## 🧭 三、启动 Label Studio

1. 启动服务：

   ```bash
   label-studio
   ```

2. 打开浏览器访问提示的网址（通常是 [http://localhost:8080）。](http://localhost:8080）。/)

------

## ✳️ 四、创建标注项目

1. 点击 **“Create Project / 新建项目”**；
2. 输入名称（例如“意图识别标注项目”）；
3. 在左侧菜单点击 **Labeling Setup / 标注配置**；
4. 打开你刚生成的 `ls_config.xml` 文件；
5. 将里面的全部内容复制粘贴到配置框中；
6. 点击 **Save** 保存。

------

## 📥 五、导入任务数据

1. 进入项目主页；
2. 点击 **Import / 导入数据**；
3. 上传文件 `ls_tasks.json`；
4. 系统会显示任务数量（如 “Imported 5000 tasks”）。

------

## 🖊 六、开始人工标注

在 Label Studio 界面中：

- 每条样本都会显示：
  - 文本内容（`$text`）；
  - 弱标注结果（供参考）；
  - “主意图（必选·单选）”；
  - “次意图（可选·多选）”；
  - 备注框（可填可不填）。

✅ 主意图必须选一项，否则无法提交。
 ✅ 次意图可多选，也可以不选。

点击 **Submit / 提交** 保存结果。

------

## 📤 七、导出已标注数据

标注一部分后：

1. 回到项目主页；

2. 点击右上角 **Export**；

3. 选择 **JSON 格式**；

4. 导出文件命名为：

   ```
   label_studio_export.json
   ```

   并放到项目根目录下。

------

## 🔧 八、合并导出结果（生成干净训练集）

运行合并脚本（`merge_ls_export.py`）：

```bash
python merge_ls_export.py
```

它会生成：

```
intent_labeled.jsonl
```

文件结构如下：

```json
{"text": "我最近咳嗽厉害怎么办", "primary_intent": "symptom_inquiry", "secondary_intents": ["health_education"]}
```

------

## ✅ 九、工作流程回顾

| 阶段     | 文件                                          | 说明                         |
| -------- | --------------------------------------------- | ---------------------------- |
| 任务生成 | `make_ls_tasks.py`                            | 从 Huatuo 数据集生成问句任务 |
| 配置文件 | `ls_config.xml`                               | 主意图单选、次意图多选       |
| 导入标注 | `ls_tasks.json`                               | 导入 Label Studio 开始标注   |
| 人工标注 | —                                             | 在网页界面标注意图           |
| 导出结果 | `label_studio_export.json`                    | 从 Label Studio 导出         |
| 合并清洗 | `merge_ls_export.py` → `intent_labeled.jsonl` | 转为标准化训练数据           |

------

是否希望我再给你补上一个**“全流程自动化脚本”**（命令行交互版，一键完成生成 → 启动 Label Studio → 自动导入项目）？
 那样你下次只需要运行一个命令就能进入标注界面。